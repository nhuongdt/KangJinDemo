@using banhang24.Hellper;
@using System.Web.Optimization
@using banhang24.AppCache
@{
    Layout = null;
    ViewBag.Title = "Open24.vn - Gói dịch vụ";
}
<style>
    /*td.check-group input[type=checkbox] {
        margin-left: 3px;
    }*/
</style>
<link rel="stylesheet" href="~/Content/Dathang.css" />
@Html.Hidden("pageID", (int)commonEnum.CheckBoxColum.goiDichVu, new { @id = "pageID" })
<div class="op-container" id="divPage">
    <input style="display:none" value="@ViewBag.shopCookies" id="txtShopCookie" />
    <input style="display:none" value="@ViewBag.cookieUserLogin" id="txtUserLogin" />
    <input type="hidden" value="@contant.GetUserCookies().ID" id="txtIDUser" />
    <div class="container-fluid nopadding">
        <div class="col-left">
            <div class=" op-filter">
                <section class="op-filter-body">
                    <article class="boxLeft " data-bind="visible: ChiNhanhs()!=null && ChiNhanhs().length > 1">
                        <h3 class="op-filter-title" onclick="toggleSubFilter(this)">
                            <img src="/Content/images/icon/loaithuchi.png">  Chi nhánh
                        </h3>
                        <aside class="op-filter-container">
                            <div class="outselect">
                                <div class=" choose-person floatleft " data-toggle="dropdown" aria-expanded="false" id="choose_TenDonVi">
                                    <ul data-bind="foreach: MangNhomDV">
                                        <li class="li-input-span">
                                            <span data-bind="text: TenDonVi">
                                            </span>&nbsp;
                                            <span data-bind="click: $parent.CloseDV">
                                                <i class="fa fa-times"></i>
                                            </span>
                                        </li>
                                    </ul>
                                    <input type="text" class="dropdown form-control" placeholder="Chọn bảng giá" id="dllChiNhanh" autocomplete="off">
                                </div>
                                <div class="selec-person dropdown-menu" id="selec-all-DV">
                                    <ul data-bind="foreach: ChiNhanhs">
                                        <li data-bind="text: TenDonVi,attr:{id: ID}, event:{click: $parent.selectedCN}">
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </aside>
                    </article>
                    <article class="boxLeft">
                        <h3 class="op-filter-title" onclick="toggleSubFilter(this)">
                            <img src="~/Content/images/icon/banggia.png" />  Bảng giá
                        </h3>
                        <aside class="op-filter-container">
                            <div class="menuCheckbox">
                                <div class="outselect">
                                    <div class="choose-person" id="choose-GB" data-toggle="dropdown" aria-expanded="true">
                                        <ul data-bind="foreach: GiaBanChosed">
                                            <li class="li-input-span">
                                                <span data-bind="text: TenGiaBan">
                                                </span>&nbsp;
                                                <span data-bind="click: $parent.CloseBangGia">
                                                    <i class="fa fa-times"></i>
                                                </span>
                                            </li>
                                        </ul>
                                        <input type="text" class="dropdown form-control" placeholder="Chọn bảng giá" autocomplete="off"
                                               data-bind="value: filterBangGia, valueUpdate: 'afterkeydown'">
                                    </div>
                                    <div class="selec-person dropdown-menu" id="selec-all-GB">
                                        <ul data-bind="foreach: arrFilterBangGia">
                                            <li data-bind="text: TenGiaBan,attr:{id: ID}, event:{click: $parent.SelectedGiaBan}">
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </aside>
                    </article>
                    <article class="boxLeft" data-bind="visible: '@ViewBag.shopCookies' ==='EDB8AAC0-14A8-4AEE-A149-DC3850DBB094'">
                        <h3 class="op-filter-title" onclick="toggleSubFilter(this)">
                            <img src="~/Content/images/icon/phongbann-28.png" />      Phòng/Bàn
                        </h3>
                        <!--show search PhongBan if NhaHang-->
                        <aside class="op-filter-container">
                            <div class="menuCheckbox">
                                <div class="outselect">
                                    <div class="choose-person" id="choose-PB" data-toggle="dropdown" aria-expanded="true">
                                        <ul data-bind="foreach: PhongBanChosed">
                                            <li class="li-input-span">
                                                <span data-bind="text: TenViTri">
                                                </span>&nbsp;
                                                <span data-bind="click: $parent.ClosePhongBan">
                                                    <i class="fa fa-times"></i>
                                                </span>
                                            </li>
                                        </ul>
                                        <input type="text" class="dropdown form-control" placeholder="Chọn phòng/bàn"
                                               data-bind="value: filterPhongBan, valueUpdate: 'afterkeydown'" autocomplete="off">
                                    </div>
                                    <div class="selec-person dropdown-menu" id="selec-all-PB">
                                        <ul data-bind="foreach: arrFilterPhongBan">
                                            <li data-bind="text: TenViTri, attr:{id: ID}, event:{click: $parent.SelectedPB}">
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </aside>
                    </article>
                    <article class="boxLeft">
                        <h3 class="op-filter-title" onclick="toggleSubFilter(this)">
                            <img src="~/Content/images/icon/phuongthuc.png" />         Phương thức
                        </h3>
                        <aside class="op-filter-container">
                            <div class="menuCheckbox">
                                <div class="outselect">
                                    <div class="choose-person" id="choose-PThuc" data-toggle="dropdown" aria-expanded="true">
                                        <ul data-bind="foreach: PThucChosed">
                                            <li class="li-input-span">
                                                <span data-bind="text: TenPhuongThuc">
                                                </span>&nbsp;
                                                <span data-bind="click: $parent.ClosePhuongThuc">
                                                    <i class="fa fa-times"></i>
                                                </span>
                                            </li>
                                        </ul>
                                        <input type="text" class="dropdown form-control" placeholder="Chọn phương thức thanh toán">
                                    </div>
                                    <div class="selec-person dropdown-menu" id="selec-pt-ThanhToan">
                                        <ul data-bind="foreach: PTThanhToan">
                                            <li data-bind="text: TenPhuongThuc, attr:{id:ID}, event:{click: $parent.ChosePTThanhToan}">
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </aside>
                    </article>
                    <article class="boxLeft">
                        <h3 class="op-filter-title" onclick="toggleSubFilter(this)">
                            <img src="~/Content/images/icon/thoigian.png" />      Thời gian
                        </h3>
                        <span></span>
                        <aside class="op-filter-container">
                            <div class="menuCheckbox">
                                <div class="form-group floatleft">
                                    <div class="radio-menu">
                                        <input type="radio" data-bind="checked: filterNgayLapHD" value="0" />
                                    </div>
                                    <div class="conten-choose">
                                        <div class=" choose-date">
                                            <div data-toggle="dropdown" aria-expanded="true">
                                                <input type="text" class="dropdown form-control choose-date-show" placeholder="Toàn thời gian"
                                                       value="Tháng này" autocomplete="off"
                                                       id="txtNgayTao">
                                            </div>
                                            <div class="dropdown-menu choseNgayTao">
                                                <div class="col-md-4 col-sm-4">
                                                    <h3>Theo ngày và tuần</h3>
                                                    <ul>
                                                        <li value="1"><a href="javascript:void(0);">Hôm nay</a></li>
                                                        <li value="2"><a href="javascript:void(0);">Hôm qua</a></li>
                                                        <li value="3"><a href="javascript:void(0);">Tuần này</a></li>
                                                        <li value="4"><a href="javascript:void(0);">Tuần trước</a></li>
                                                    </ul>
                                                </div>
                                                <div class="col-md-4 col-sm-4">
                                                    <h3>Theo tháng và quý</h3>
                                                    <ul>
                                                        <li value="6"><a href="javascript:void(0);">Tháng này</a></li>
                                                        <li value="7"><a href="javascript:void(0);">Tháng trước</a></li>
                                                        <li value="10"><a href="javascript:void(0);">Quý này</a></li>
                                                        <li value="11"><a href="javascript:void(0);">Quý trước</a></li>
                                                    </ul>
                                                </div><div class="col-md-4 col-sm-4">
                                                    <h3>Theo năm</h3>
                                                    <ul>
                                                        <li value="12"><a href="javascript:void(0);">Năm này</a></li>
                                                        <li value="13"><a href="javascript:void(0);">Năm trước</a></li>
                                                        <li value="0"><a href="javascript:void(0);">Toàn thời gian</a></li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group floatleft">
                                    <div class="radio-menu">
                                        <input type="radio" data-bind="checked: filterNgayLapHD" value="1" />
                                    </div>
                                    <div class="conten-choose">
                                        <div class="floatleft form-wrap ">
                                            <input type='text' class="form-control daterange" id="txtNgayTaoInput" name="daterange" autocomplete="off"
                                                   placeholder="23/12/2017" data-bind="value: filterNgayLapHD_Input, enable: filterNgayLapHD() !=='0'" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </aside>
                    </article>
                    <article class="boxLeft">
                        <h3 class="op-filter-title" onclick="toggleSubFilter(this)">
                            <img src="~/Content/images/icon/trangthai.png" />
                            Trạng thái
                        </h3>
                        <aside class="op-filter-container">
                            <div class="menuCheckbox">
                                <ul>
                                    <li>
                                        <label>
                                            <input type="checkbox"
                                                   data-bind="checked: TT_TamLuu, checkedValue: true, event: {change: Change_Stattus}"> Phiếu tạm
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" data-bind="checked: TT_HoanThanh, checkedValue: true, event: {change: Change_Stattus}"> Hoàn thành
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" data-bind="checked: TT_DaHuy, checkedValue: true, event: {change: Change_Stattus}"> Đã hủy
                                        </label>
                                    </li>
                                </ul>
                            </div>
                        </aside>
                    </article>
                </section>
                <div class="op-filter-footer">
                    <button type="button" class="btn btn-link" style="color:red" onclick="closeFilter()">Hủy</button>
                    <button type="button" class="btn btn-link" onclick="collapseSubFilter(this)">
                        <span>Thu gọn</span>
                    </button>
                    <button type="button" class="btn btn-link" style="display:none" onclick="expandSubFilter(this)">
                        <span>Mở rộng</span>
                    </button>
                    <button type="button" class="btn btn-main kv2Btn" onclick="closeFilter()">Hoàn tất</button>
                </div>
            </div>
        </div>
        <div class="col-right">
            <div class="op-header">
                <div class="op-header-title">
                    <h2 class="pull-left title">@banhang24.Resources.ResourceTexts.Exchange / Gói dịch vụ</h2>
                </div>
                <div class="flex flex-between">
                    <div class=" header-button">
                        <div class="btn-group clickbanhang" style="display:none" title="Thêm mới hóa đơn bán">
                            <div type="button" class="btn btn-main  dropdown-toggle add-new btn-main" data-bind="click: clickbanhang">
                                <i class="fa fa-plus"></i><font>Thêm mới</font>
                            </div>
                        </div>
                        <button class="btn-link shownhapxuat " id="shownhapxuat" title="Chức năng nhập xuất" style="width:30px;">
                            <i class="material-icons"> more_vert</i>
                        </button>
                        <div class="btnMenu_hide  btn-group ">
                            <button type="button" class="btn btn-main dropdown-toggle btnExport" data-toggle="dropdown" data-bind="click: ExportExcel_HoaDon" id="btnExport" hidden>
                                <i class="fa fa-file-excel-o"></i> Xuất file
                            </button>
                        </div>
                        <div class="btn-group clickbanhang  ">
                            <button type="button" class="btn btn-main dropdown-toggle btnExport" data-bind="click:$root.showModalImportTonGDV"
                                    id="btnImportTonDV">
                                <img src="/Content/images/icon/right2.png"> Nhập file tồn dịch vụ
                            </button>
                        </div>
                        <div class="dropdown open ">
                            <button type="button" class="btn btn-main" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" onclick="showCollumnFilter(this)"
                                    id="btnViewCheck">
                                <i class="fa fa-angle-double-down"></i>
                            </button>
                            <div class=" dropdown-list dropdown-list-two" style="display:none; right:0" id="myList">
                                <div class="col-md-6 dropdown-left">
                                    <ul data-bind="foreach: ListCheckBox">
                                        <!--ko if: $index() < $root.NumberColum_Div2()-->
                                        <li>
                                            <div class="checkbox">
                                                <label>
                                                    <input type="checkbox" class="checkbox" checked="checked" data-bind="value: Key">
                                                    <span></span>
                                                    <label class="nopadding" data-bind="text: Value"></label>
                                                </label>
                                            </div>
                                        </li>
                                        <!--/ko-->
                                    </ul>
                                </div>
                                <div class="col-md-6 dropdown-right">
                                    <ul data-bind="foreach: ListCheckBox">
                                        <!--ko if: $index() >= $root.NumberColum_Div2()-->
                                        <li>
                                            <div class="checkbox">
                                                <label>
                                                    <input type="checkbox" class="checkbox" checked="checked" data-bind="value: Key">
                                                    <span></span>
                                                    <label class="nopadding" data-bind="text: Value"></label>
                                                </label>
                                            </div>
                                        </li>
                                        <!--/ko-->
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="flex">
                        <div class="op-search">
                            <input type="text" class="form-control" placeholder="Mã hóa đơn, Tên KH, SĐT, Mã (tên) hàng hóa, Người tạo, Người bán" id="txtMaHD"
                                   data-bind="value: filter, valueUpdate: 'afterkeydown'" autocomplete="off" />
                            <button type="button" class=" op-search-button" data-bind="click: Click_IconSearch">
                                <i class="fa fa-search"></i>
                            </button>
                        </div>
                        <button class="btn btn-main op-filter-toggle" onclick="showFilter()" title="Hiển thị bộ lọc">
                            <i class="material-icons">sort</i>
                        </button>
                    </div>
                </div>
                <div class="btn-group operation" id="divThaoTac">
                    <button type="button" class="btn btn-main  btn-main" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa fa-bars"></i><font>Thao tác</font> <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu ">
                        <li>
                            <a href="javascript:void(0);" data-bind="click: PrintMany" id="btnPrintMany">
                                <i class="fa fa-trash"></i>&nbsp;In
                            </a>
                        </li>
                    </ul>
                    <div style="display:inline-block; margin:5px; height:16px">
                        Có&nbsp;
                        <span>
                            <a href="javascript:void(0)"
                               data-bind="click:">
                                <span id="count"></span>&nbsp;hóa đơn
                            </a>
                        </span>được chọn
                        <span onclick="RemoveAllCheck()">
                            <a href="javascript:void(0)">
                                &nbsp;&nbsp;&nbsp;&nbsp; <i class="fa fa-times icon-del">
                                </i>Bỏ chọn tất cả
                            </a>
                        </span>
                    </div>
                </div>
                <!--nhuongdt add-->
                <!--end-->
            </div>
            <div class="content-table  content-table" id="myScrollspy" style="top: 48px;position: sticky;">
                <div class="table-reponsive bangchung table-frame">
                    <table class=" table table-new table-hover" id="tb">
                        <thead class="thead-boder">
                            <tr>
                                <th class="check-group check-group-main">
                                    <input type="checkbox" class="ckHeader" onclick="SetCheckAll(this)">
                                </th>
                                @if ((string)ViewBag.ShopCookies == "C16EDDA0-F6D0-43E1-A469-844FAB143014")
                                {
                                    // gara
                                    foreach (var item in commonEnum.ServicePackage)
                                    {
                                        <th class="@item.Key">
                                            <a class="black" href="javascript:void(0)">@item.Value</a>
                                        </th>
                                    }
                                }
                                else
                                {
                                    string[] keyNotGara = { "bienso" };
                                    foreach (var item in commonEnum.ServicePackage.Where(x => x.Key.Any(y => keyNotGara.Contains(x.Key) == false)))
                                    {
                                        <th class="@item.Key">
                                            <a class="black" href="javascript:void(0)">@item.Value</a>
                                        </th>
                                    }
                                }
                            </tr>
                        </thead>
                        <tbody data-bind="foreach: {data: HoaDons, as: 'HoaDons' }">
                            <tr class="prev-tr-hide" data-bind="attr:{id: ID}, css:{bggray : $index()%2 == 1}">
                                <td class="check-group">
                                    <input type="checkbox" data-bind="attr:{id: ID}" onclick="ChoseHoaDon(this)" />
                                </td>
                                <td class="@commonEnum.TypeServicepackage.mahoadon"
                                    data-bind="text: MaHoaDon, click: $parent.LoadChiTietHD"></td>
                                <td class="@commonEnum.TypeServicepackage.ngaylaphoadon" data-bind="click: $parent.LoadChiTietHD">
                                    <span data-bind="text: moment(NgayLapHoaDon).format('DD/MM/YYYY HH:mm')!='Invalid date'? moment(NgayLapHoaDon).format('DD/MM/YYYY HH:mm'):''"></span>
                                </td>
                                <td class="@commonEnum.TypeServicepackage.ngayapdung" data-bind="text:NgayApDungGoiDV, click: $parent.LoadChiTietHD"></td>
                                <td class="@commonEnum.TypeServicepackage.ngayhethan" data-bind="text:HanSuDungGoiDV, click: $parent.LoadChiTietHD"></td>
                                <!-- ko if: $root.isGara() -->
                                <td class="@commonEnum.ColumnInvoices.bienso">
                                    <a href="=javascript:void(0)" data-bind="text: BienSo, click: function(){ $root.gotoKhachHang($data,3)}"></a>
                                </td>
                                <!--/ko-->
                                <td class="@commonEnum.TypeServicepackage.makhachhang">
                                    <a href="=javascript:void(0)" data-bind="text: MaDoiTuong, click: function(){ $root.gotoKhachHang($data,1)}"></a>
                                </td>
                                <td class="@commonEnum.TypeServicepackage.khachhang" data-bind="click: $parent.LoadChiTietHD">
                                    <span data-bind="text: TenDoiTuong"></span>
                                    <span data-bind="text: TheoDoi== false?'':'{DEL}'" style="color:chocolate"></span>
                                </td>
                                <td class="@commonEnum.TypeServicepackage.didong" data-bind="text:DienThoai, click: $parent.LoadChiTietHD"></td>
                                <td class="@commonEnum.TypeServicepackage.diachi" data-bind="text:DiaChiKhachHang, click: $parent.LoadChiTietHD"></td>
                                <td class="@commonEnum.TypeServicepackage.khuvuc" data-bind="text:KhuVuc, click: $parent.LoadChiTietHD"></td>
                                <td class="@commonEnum.TypeServicepackage.chinhanhbanhang" data-bind="text:TenDonVi, click: $parent.LoadChiTietHD"></td>
                                <td class="@commonEnum.TypeServicepackage.nguoiban" data-bind="text:TenNhanVien, click: $parent.LoadChiTietHD"></td>
                                <td class="@commonEnum.TypeServicepackage.nguoitao" data-bind="text:NguoiTaoHD, click: $parent.LoadChiTietHD"></td>
                                <td class="@commonEnum.TypeServicepackage.tongtienhang text-right" data-bind="text: formatNumber3Digit(TongTienHang,2), click: $parent.LoadChiTietHD"></td>
                                <td class="@commonEnum.ColumnInvoices.tienthue text-right" data-bind="text: formatNumber3Digit(TongTienThue,2), click: $parent.LoadChiTietHD"></td>
                                <td class="@commonEnum.TypeServicepackage.giamgia text-right" data-bind="text: formatNumber3Digit(TongGiamGia + KhuyeMai_GiamGia,2), click: $parent.LoadChiTietHD"></td>
                                <td class="@commonEnum.TypeServicepackage.khachcantra text-right" data-bind="text: formatNumber3Digit(PhaiThanhToan,2), click: $parent.LoadChiTietHD"></td>
                                <td class="@commonEnum.ColumnInvoices.butruTraHang text-right" data-bind="text: formatNumber3Digit(TongTienHDTra,2), click: $parent.LoadChiTietHD"></td>
                                <td class="@commonEnum.ColumnInvoices.gtriSauTra text-right" data-bind="text: formatNumber3Digit(PhaiThanhToan - TongTienHDTra,2), click: $parent.LoadChiTietHD"></td>
                                <td class="@commonEnum.TypeServicepackage.khachdatra text-right" data-bind="text: ChoThanhToan==null?0:formatNumber3Digit(KhachDaTra,2), click: $parent.LoadChiTietHD"></td>
                                <td class="@commonEnum.TypeServicepackage.tienmat text-right" data-bind="text: formatNumber3Digit(TienMat,2), click: $parent.LoadChiTietHD"></td>
                                <td class="@commonEnum.TypeServicepackage.chuyenkhoan text-right" data-bind="text: formatNumber3Digit(ChuyenKhoan,2), click: $parent.LoadChiTietHD"></td>
                                <td class="@commonEnum.TypeServicepackage.tienpos text-right" data-bind="text: formatNumber3Digit(TienATM,2), click: $parent.LoadChiTietHD"></td>
                                <td class="@commonEnum.TypeServicepackage.tiendoidiem text-right" data-bind="text: formatNumber3Digit(TienDoiDiem,2), click: $parent.LoadChiTietHD"></td>
                                <td class="@commonEnum.TypeServicepackage.tienthegiatri text-right" data-bind="text: formatNumber3Digit(ThuTuThe,2), click: $parent.LoadChiTietHD"></td>
                                <td class="@commonEnum.TypeServicepackage.conlai text-right"
                                    data-bind="text: formatNumber3Digit(ConNo,2), style: {color: ConNo > 0 && ChoThanhToan!=null?'red':'black'},
                                        click: $parent.LoadChiTietHD"></td>
                                <td class="@commonEnum.TypeServicepackage.ghichu" data-bind="text: commonStatisJs.SubStringContent(DienGiai,50), click: $parent.LoadChiTietHD"></td>
                                <td class="@commonEnum.TypeServicepackage.trangthai" data-bind="text: TrangThaiText, click: $parent.LoadChiTietHD"></td>
                            </tr>
                            <tr class="op-js-tr-hide">
                                <td colspan="18">
                                    <div class="op-object-detail ">
                                        <ul class="nav nav-tabs">
                                            <li class="active" onclick="LoadGetHeight()"><a data-toggle="tab" data-bind="attr:{href:'#home_'+ ID}">Thông tin</a></li>
                                            <li onclick="LoadGetHeight()"><a data-toggle="tab" data-bind="attr:{href:'#hisTH_'+ ID}, visible: $parent.VisibleHisTraHang ">Nhật ký trả hàng</a></li>
                                            <li onclick="LoadGetHeight()"><a data-toggle="tab" data-bind="attr:{href:'#infor_'+ ID}, visible: ChoThanhToan !== null">Nhật ký thanh toán</a></li>
                                        </ul>
                                        <div class="tab-content">
                                            <div class="tab-pane active" data-bind="attr:{id:'home_'+ ID}">
                                                <div class="op-object-detail ">
                                                    <div class="col-md-12 nopadding">
                                                        <div class="op-object-detail-left min-45 ">
                                                            <div class="form-group floatleft">
                                                                <label class="css-form-label"> Chi nhánh:</label>
                                                                <div class="css-form-detail">
                                                                    <span data-bind="text: TenDonVi"></span>
                                                                </div>
                                                            </div>
                                                            <div class="form-group floatleft ">
                                                                <label class="css-form-label">Người tạo:</label>
                                                                <div class="css-form-detail">
                                                                    <span data-bind="text: NguoiTaoHD"></span>
                                                                </div>
                                                            </div>
                                                            <div class="form-group floatleft">
                                                                <label class="css-form-label">Mã hóa đơn:</label>
                                                                <div class="css-form-detail">
                                                                    <span data-bind="text:MaHoaDon"></span>
                                                                </div>
                                                            </div>
                                                            <div class="form-group floatleft ">
                                                                <label class="css-form-label">Bảng giá:</label>
                                                                <div class="css-form-detail">
                                                                    <span data-bind="text: TenBangGia, visible: TenBangGia !==null"></span>
                                                                </div>
                                                            </div>
                                                            <div class="form-group floatleft">
                                                                <label class="css-form-label">Khách hàng:</label>
                                                                <div class="css-form-detail">
                                                                    <span data-bind="text: TenDoiTuong">
                                                                    </span>
                                                                </div>
                                                            </div>
                                                            <div class="form-group floatleft ">
                                                                <label class="css-form-label">Ngày lập HĐ:</label>
                                                                <div class="css-form-detail">
                                                                    <input type='text' class="form-control txtNgayLapHD" placeholder="23/12/2017"
                                                                           data-bind="value: moment(NgayLapHoaDon).format('DD/MM/YYYY HH:mm')!='Invalid date'? moment(NgayLapHoaDon).format('DD/MM/YYYY HH:mm'):'',
                                                                                       enable: $parent.ThayDoi_NgayLapHD() && $parent.Enable_NgayLapHD() && $root.Role_ChangeInvoice_ifOtherDate()" />
                                                                </div>
                                                            </div>
                                                            <div class="form-group floatleft ">
                                                                <label class="css-form-label">Ngày áp dụng:</label>
                                                                <div class="css-form-detail">
                                                                    <input type='text' class="form-control txtNgayApDung" placeholder="23/12/2017"
                                                                           data-bind="value: NgayApDungGoiDV,
                                                                                       enable: $parent.ThayDoi_NgayLapHD() && $parent.Enable_NgayLapHD()" />
                                                                </div>
                                                            </div>
                                                            <div class="form-group floatleft ">
                                                                <label class="css-form-label">Ngày hết hạn:</label>
                                                                <div class="css-form-detail">
                                                                    <input type='text' class="form-control txtNgayHetHan" placeholder="23/12/2017"
                                                                           data-bind="value: HanSuDungGoiDV,
                                                                                       enable: $parent.ThayDoi_NgayLapHD() && $parent.Enable_NgayLapHD()" />
                                                                </div>
                                                            </div>
                                                            <div class="form-group floatleft ">
                                                                <label class="css-form-label">Người bán:</label>
                                                                <div class="css-form-detail">
                                                                    <select class="form-control"
                                                                            data-bind="options: $root.NhanViens, optionsText: 'TenNhanVien', optionsValue: 'ID', value: $data.ID_NhanVien,
                                                                                event:{change: $root.GetID_NhanVien}, enable: $parent.Enable_NgayLapHD() && $parent.ThayDoi_NVienBan()"></select>
                                                                </div>
                                                            </div>
                                                            <div class="form-group floatleft">
                                                                <label class="css-form-label">Trạng thái:</label>
                                                                <div class="css-form-detail">
                                                                    <span data-bind="text: TrangThaiText"></span>
                                                                </div>
                                                            </div>
                                                            <div class="form-group floatleft border-end">
                                                                <label class="css-form-label">Ghi chú:</label>
                                                                <div class="css-form-detail">
                                                                    <textarea rows="2" data-bind="value: DienGiai, enable: $parent.Enable_NgayLapHD()"></textarea>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="op-object-detail-right">
                                                            <div class="table-res loadcthd">
                                                                <table class=" table table-filter table-detal">
                                                                    <thead>
                                                                        <tr>
                                                                            <th>
                                                                                <div class="col-md-3 header-title-filter">
                                                                                    Mã hàng hóa  <span class="glyphicon glyphicon-search icon-filter"></span>
                                                                                </div>
                                                                                <div class="col-md-8">
                                                                                    <div class="right-inner-addon" hidden>
                                                                                        <span class="glyphicon glyphicon-search"></span>
                                                                                        <input type="text" class="form-control"
                                                                                               data-bind="value: $parent.filterHangHoa_ChiTietHD, valueUpdate: 'afterkeydown'"
                                                                                               placeholder="Tìm kiếm chi tiết hàng hóa">
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-md-1">
                                                                                    <span class="glyphicon glyphicon-chevron-left  icon-filter2" hidden></span>
                                                                                </div>
                                                                            </th>
                                                                            <th>Tên hàng</th>
                                                                            <th>Đvt</th>
                                                                            <th data-bind="visible: $root.ShowColumn_LoHang">Lô hàng</th>
                                                                            <th>Số lượng</th>
                                                                            <th>Đơn giá</th>
                                                                            <th>Giảm giá</th>
                                                                            <th>Giá bán</th>
                                                                            <th class="text-right">Thành tiền</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody data-bind="foreach: $parent.PageResult_CTHoaDons">
                                                                        <tr>
                                                                            <td>
                                                                                <span data-bind="text: MaHangHoa"></span>
                                                                                <span data-bind="text: Del" style="color:red"></span>
                                                                            </td>
                                                                            <td>
                                                                                <span data-bind="text: TenHangHoa"></span>
                                                                                <i class="fal fa-info-circle" title="Thành phần combo"
                                                                                   data-bind="visible: LoaiHangHoa ==3, click: $root.showTPComBo"></i>
                                                                                <span data-bind="text: ThuocTinh_GiaTri" style="color:chocolate"></span>
                                                                                <span data-bind="visible: ID_KhuyenMai!==null">
                                                                                    <i class="fa fa-gift bg-pink"></i>
                                                                                </span>
                                                                                <br />
                                                                                <span data-bind="text: GhiChu_NVThucHien" style="font-size:13px; font-style: italic"></span>
                                                                                <br data-bind="visible: GhiChu_NVThucHien" />
                                                                                <span data-bind="text: GhiChu_NVTuVan" style="font-size:13px; font-style: italic"></span>
                                                                            </td>
                                                                            <td style="color: #8abb0f" data-bind="text: TenDonViTinh"></td>
                                                                            <td style="color:palevioletred"
                                                                                data-bind="visible: $root.ShowColumn_LoHang,click: $root.Goto_LoHang">
                                                                                <a href="javascript:void(0)" style="color:palevioletred" data-bind="text:MaLoHang !== '' && MaLoHang !== null? MaLoHang:''"></a>
                                                                            </td>
                                                                            <td class="text-center" data-bind="text: formatNumber3Digit(SoLuong)"></td>
                                                                            <td data-bind="text: formatNumber3Digit(DonGia)"></td>
                                                                            <td data-bind="text: formatNumber3Digit(GiamGia)"></td>
                                                                            <td data-bind="text: formatNumber3Digit(GiaBan)"></td>
                                                                            <td class="text-right" data-bind="text: formatNumber3Digit(ThanhTien,2) "></td>
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                            <div class="page">
                                                                <div class="flex flex-end">
                                                                    <a href="javascript:void(0)" data-bind="click: $root.StartPage_CTHD, visible: $root.VisibleStartPage_CTHD"><i class="fa fa-step-backward" aria-hidden="true"></i></a>
                                                                    <a href="javascript:void(0)" data-bind="click: $root.BackPage_CTHD, visible: $root.VisibleStartPage_CTHD "><i class="fa fa-caret-left" aria-hidden="true"></i></a>
                                                                    <ul data-bind="foreach: $root.PageList_CTHD">
                                                                        <li>
                                                                            <a href="javascript:void(0)" data-bind="text: pageNumber, click: $root.GoToPage_CTHD, css: $root.GetClass_CTHD($data)"></a>
                                                                        </li>
                                                                    </ul>
                                                                    <a href="javascript:void(0)" data-bind="click: $root.GoToNextPage_CTHD, visible: $root.VisibleEndPage_CTHD "><i class="fa fa-caret-right" aria-hidden="true"></i></a>
                                                                    <a href="javascript:void(0)" data-bind="click: $root.EndPage_CTHD, visible: $root.VisibleEndPage_CTHD "><i class="fa fa-step-forward" aria-hidden="true"></i></a>
                                                                    <div class="total-recos">
                                                                        Hiển thị <span data-bind="text: $root.fromitem_CTHD"></span> - <span data-bind="text: $root.toitem_CTHD"></span> trên tổng số
                                                                        <span data-bind="text: $root.TotalRecord_CTHD"></span> bản ghi
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="op-table-summary">
                                                                <div class="col-md-6 col-xs-12">
                                                                    <!-- if KhuyenMai_GhiChu =' <br />' then KhuyenMai_GhiChu.length = 7 -->
                                                                    <div class="khuyenmaihh" style="white-space:normal" data-bind="visible: KhuyenMai_GhiChu !== 'undefined' && KhuyenMai_GhiChu!==null && KhuyenMai_GhiChu.length > 7">
                                                                        Khuyến mại <i class="fa fa-gift bg-pink"></i>
                                                                        <div data-bind="html: KhuyenMai_GhiChu== 'undefined'?'': KhuyenMai_GhiChu">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6 col-xs-12 footer-total-detail">
                                                                    <div class="floatleft sum-prduct">
                                                                        <div class="col-xs-5 col-sm-5  col-lg-7 text-right">
                                                                            Tổng tiền hàng :
                                                                        </div>
                                                                        <div class="col-xs-7 col-sm-7 col-lg-5 text-right">
                                                                            <div class="row" data-bind="text: formatNumber3Digit(TongTienHang,2)">
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="floatleft sum-prduct" data-bind="visible: TongTienThue>0">
                                                                        <div class="col-xs-5 col-sm-5  col-lg-7 text-right">
                                                                            Thuế VAT :
                                                                        </div>
                                                                        <div class="col-xs-7 col-sm-7 col-lg-5 text-right">
                                                                            <div class="row" data-bind="text: formatNumber3Digit(TongTienThue,2)">
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="floatleft sum-prduct">
                                                                        <div class="col-xs-5 col-sm-5  col-lg-7 text-right">
                                                                            Giảm hóa đơn :
                                                                        </div>
                                                                        <div class="col-xs-7 col-sm-7 col-lg-5 text-right">
                                                                            <div class="row" data-bind="text: formatNumber3Digit(TongGiamGia + KhuyeMai_GiamGia,2)">
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="floatleft sum-prduct" data-bind="visible: LoaiHoaDonGoc===6">
                                                                        <div class="col-xs-5 col-sm-5  col-lg-7 text-right">
                                                                            Tổng tiền hóa đơn trả :
                                                                            <span>
                                                                                <a href="javascript:void(0)" data-bind="text: MaHoaDonGoc, click: $parent.gotoHoaDonTH"></a>
                                                                            </span>
                                                                        </div>
                                                                        <div class="col-xs-7 col-sm-7 col-lg-5 text-right">
                                                                            <div class="row" data-bind="text: formatNumber3Digit(TongTienHDTra,2)">
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="floatleft sum-prduct">
                                                                        <div class="col-xs-5 col-sm-5  col-lg-7 text-right">
                                                                            Khách cần trả :
                                                                        </div>
                                                                        <div class="col-xs-7 col-sm-7 col-lg-5 text-right">
                                                                            <div class="row" data-bind="text: formatNumber3Digit(PhaiThanhToan,2)">
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="floatleft sum-prduct">
                                                                        <div class="col-xs-5 col-sm-5  col-lg-7 text-right">
                                                                            Khách đã trả :
                                                                        </div>
                                                                        <div class="col-xs-7 col-sm-7 col-lg-5 text-right">
                                                                            <div class="row" data-bind="text: ChoThanhToan==null?0:formatNumber3Digit(KhachDaTra,2)">
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div style="display:flex; flex-direction:row; flex-wrap:wrap; justify-content:flex-end">
                                                                <!-- ko if: $root.Enable_NgayLapHD() && ($root.Role_HoaHongDichVu_Edit() || $root.Role_HoaHongHoaDon_Edit()) -->
                                                                <div class="dropdown-mauin btn-group" style="float:unset">
                                                                    <button href="javascript:void(0)" class="btn btn-main btnPrint bor-r">
                                                                        <i class="fa fa-user"></i> Sửa chiết khấu
                                                                    </button>
                                                                    <button class="btn btn-main  dropdown-toggle dropdown-toggle-split" data-toggle="dropdown">
                                                                        <span>
                                                                            <span class="caret"></span>
                                                                        </span>
                                                                    </button>
                                                                    <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                                                                        <!-- ko if: $root.Role_HoaHongDichVu_Edit()-->
                                                                        <li data-bind="click: $root.showModalEditCKDichVu">
                                                                            <a> <i class="fa fa-xing"></i> Hoa hồng dịch vụ</a>
                                                                        </li>
                                                                        <!--/ko-->
                                                                    </ul>
                                                                </div>
                                                                <!--/ko-->
                                                                <!-- ko if: $root.Enable_NgayLapHD() && $root.Show_BtnEdit() && $root.Role_ChangeInvoice_ifOtherDate()-->
                                                                <button href="javascript:void(0)" class="btn btn-main"
                                                                        data-bind="visible: KhachDaTra == 0, click: function(){$parent.SaoChepHD($data, 2)}">
                                                                    <i class="fa fa-share"></i> Sửa đổi
                                                                </button>
                                                                <!--/ko-->
                                                                <!-- ko if: $root.Enable_NgayLapHD() && $root.Show_BtnOpenHD()-->
                                                                <a href="javascript:void(0)" class="btn btn-main" data-bind="click: function(){$parent.SaoChepHD($data, 1)}">
                                                                    <i class="fa fa-share"></i>Mở phiếu
                                                                </a>
                                                                <!--/ko-->
                                                                <!-- ko if:  $root.Enable_NgayLapHD() && $root.Show_BtnUpdate()-->
                                                                <button href="javascript:void(0)" class="btn btn-main" data-bind="click: $parent.updateHoaDon">
                                                                    <i class="fa fa-save"></i> Lưu
                                                                </button>
                                                                <!--/ko-->
                                                                <!-- ko if: $root.Role_PrintHoaDon()-->
                                                                <div class="dropdown-mauin btn-group" style="float:unset">
                                                                    <button href="javascript:void(0)" class="btn btn-main btnPrint bor-r" data-bind="click: $parent.InHoaDon">
                                                                        <i class="fa fa-print"></i> In
                                                                    </button>
                                                                    <button class="btn btn-main  dropdown-toggle dropdown-toggle-split" data-toggle="dropdown">
                                                                        <span>
                                                                            <span class="caret"></span>
                                                                        </span>
                                                                    </button>
                                                                    <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel" data-bind="foreach:$root.ListTypeMauIn ">
                                                                        <li data-bind="click:function() { $root.PrinDatHang($parent,Key) }"><a data-bind="text:Value"></a></li>
                                                                    </ul>
                                                                </div>
                                                                <!--/ko-->
                                                                <!-- ko if: $root.RoleExport_ServicePackage()-->
                                                                <button href="javascript:void(0)" class="btn btn-main btnExportDetail" data-bind="click: $parent.ExportExcel_ChiTietHoaDon">
                                                                    <i class="fa fa-file-excel-o"></i> Xuất file
                                                                </button>
                                                                <!--/ko-->
                                                                @*GDVDoi: không cho hủy, mà phải hủy từ phiếu trả*@
                                                                <!-- ko if: $root.Enable_NgayLapHD() && $root.Show_BtnDelete() && $root.Role_DeleteInvoice_ifOtherDate() && LoaiHoaDonGoc !==6 -->
                                                                <button href="javascript:void(0)" class="btn btn-cancel clickxoaHD"
                                                                        data-bind="click: $root.HuyHoaDon_updateChoThanhToan">
                                                                    <i class="fa fa-close"></i> Hủy bỏ
                                                                </button>
                                                                <!--/ko-->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="tab-pane" data-bind="attr:{id:'hisTH_'+ ID}">
                                                <div class="table-res">
                                                    <table class='table'>
                                                        <tr>
                                                            <th>Mã trả hàng</th>
                                                            <th>Thời gian</th>
                                                            <th>Người nhận trả</th>
                                                            <th>Tổng cộng</th>
                                                            <th>Trạng thái</th>
                                                        </tr>
                                                        <tbody data-bind="foreach: $parent.LichSuTraHang">
                                                            <tr>
                                                                <td>
                                                                    <a href="javascript:void(0)"
                                                                       data-bind="text: MaHoaDon, click: function(){ $root.ShowPopup_InforHD_PhieuThu($data, $parent)}"></a>
                                                                </td>
                                                                <td data-bind="text: moment(NgayLapHoaDon).format('DD/MM/YYYY HH:mm')!='Invalid date'? moment(NgayLapHoaDon).format('DD/MM/YYYY HH:mm'):''"></td>
                                                                <td data-bind="text: TenNhanVien"></td>
                                                                <td data-bind="text: formatNumber3Digit(TongTienHang,2)"></td>
                                                                <td data-bind="text: TrangThai"></td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <div class="tab-pane" data-bind="attr:{id:'infor_'+ ID}">
                                                <div class="table-res">
                                                    <table class='table'>
                                                        <tr data-bind="visible: $parent.LichSuThanhToan()!=null && $parent.LichSuThanhToan().length >0">
                                                            <th>Mã phiếu</th>
                                                            <th>Thời gian</th>
                                                            <th>Người tạo</th>
                                                            <th>Phương thức</th>
                                                            <th>Trạng thái</th>
                                                            <th>Tiền thu</th>
                                                        </tr>
                                                        <tbody data-bind="foreach: $parent.LichSuThanhToan">
                                                            <tr>
                                                                <td>
                                                                    <a href="javascript:void(0)"
                                                                       data-bind="text: MaHoaDon, click: function(){ $root.ShowPopup_InforHD_PhieuThu($data, $parent)}"></a>
                                                                </td>
                                                                <td data-bind="text: moment(NgayLapHoaDon).format('DD/MM/YYYY HH:mm')!='Invalid date'? moment(NgayLapHoaDon).format('DD/MM/YYYY HH:mm'):''"></td>
                                                                <td data-bind="text: NguoiTao"></td>
                                                                <td data-bind="text: PhuongThucTT"></td>
                                                                <td data-bind="text: TrangThai==false?'Đã hủy':'Đã thanh toán'"></td>
                                                                <td data-bind="text: formatNumber3Digit(TongTienThu,2)"></td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                    <!-- ko if: $root.Show_BtnThanhToanCongNo() && ConNo > 0-->
                                                    <div class=" floatleft text-right padingtop">
                                                        <a href="javascript:void(0)" class="btn btn-main"
                                                           data-bind="click: $parent.showPopThanhToan">
                                                            <i class="fa fa-calculator"></i>&nbsp; Thanh toán
                                                        </a>
                                                    </div>
                                                    <!--/ko-->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                        <tfoot id="footerSum" data-bind="visible: HoaDons().length > 0">
                            <tr class="border-bottom bold">
                                <td class="hd0"></td>
                                <td class="@commonEnum.TypeServicepackage.mahoadon">Tổng cộng</td>
                                <td class="@commonEnum.TypeServicepackage.ngaylaphoadon"></td>
                                <td class="@commonEnum.TypeServicepackage.ngayapdung"></td>
                                <td class="@commonEnum.TypeServicepackage.ngayhethan"></td>
                                <!-- ko if: $root.isGara() -->
                                <td class="@commonEnum.ColumnInvoices.bienso"></td>
                                <!--/ko-->
                                <td class="@commonEnum.TypeServicepackage.makhachhang"></td>
                                <td class="@commonEnum.TypeServicepackage.khachhang"></td>
                                <td class="@commonEnum.TypeServicepackage.didong"></td>
                                <td class="@commonEnum.TypeServicepackage.diachi"></td>
                                <td class="@commonEnum.TypeServicepackage.khuvuc"></td>
                                <td class="@commonEnum.TypeServicepackage.chinhanhbanhang"></td>
                                <td class="@commonEnum.TypeServicepackage.nguoiban"></td>
                                <td class="@commonEnum.TypeServicepackage.nguoitao"></td>
                                <td class="@commonEnum.TypeServicepackage.tongtienhang text-right" data-bind="text: formatNumber3Digit(TongTienHang(),2)"></td>
                                <td class="@commonEnum.ColumnInvoices.tienthue text-right" data-bind="text: formatNumber3Digit(TongTienThue(),2)"></td>
                                <td class="@commonEnum.TypeServicepackage.giamgia text-right" data-bind="text: formatNumber3Digit(TongGiamGia() + TongGiamGiaKM(),2)"></td>
                                <td class="@commonEnum.TypeServicepackage.khachcantra text-right" data-bind="text: formatNumber3Digit(TongThanhToan(),2)"></td>
                                <td class="@commonEnum.ColumnInvoices.butruTraHang"></td>
                                <td class="@commonEnum.ColumnInvoices.gtriSauTra"></td>
                                <td class="@commonEnum.TypeServicepackage.khachdatra text-right" data-bind="text: formatNumber3Digit(TongKhachTra(),2)"></td>
                                <td class="@commonEnum.TypeServicepackage.tienmat text-right" data-bind="text: formatNumber3Digit(TongTienMat(),2)"></td>
                                <td class="@commonEnum.TypeServicepackage.chuyenkhoan text-right" data-bind="text: formatNumber3Digit(TongChuyenKhoan(),2)"></td>
                                <td class="@commonEnum.TypeServicepackage.tienpos text-right" data-bind="text: formatNumber3Digit(TongPOS(),2)"></td>
                                <td class="@commonEnum.TypeServicepackage.tiendoidiem text-right" data-bind="text: formatNumber3Digit(TongTienDoiDiem(),2)"></td>
                                <td class="@commonEnum.TypeServicepackage.tienthegiatri text-right" data-bind="text: formatNumber3Digit(TongTienTheGTri(),2)"></td>
                                <td class="@commonEnum.TypeServicepackage.conlai text-right" data-bind="text: formatNumber3Digit(TongKhachNo(),2)"></td>
                                <td class="@commonEnum.TypeServicepackage.ghichu"></td>
                                <td class="@commonEnum.TypeServicepackage.trangthai"></td>
                            </tr>
                        </tfoot>
                        <tfoot class="Report_Empty" data-bind="visible: HoaDons().length === 0">
                            <tr class="text-center">
                                <td colspan="25">
                                    <i>Không có dữ liệu</i>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                <div class="page">
                    <div class="flex flex-row">
                        <label>Số bản ghi:</label>
                        <select id="SelecttedPage" class="form-control seleted-page" data-bind="value: pageSize,
                                                options: pageSizes, event: {change: ResetCurrentPage}"></select>
                    </div>
                    <div class="flex flex-end">
                        <a href="javascript:void(0)" data-bind="click: $root.StartPage, visible: VisibleStartPage"><i class="fa fa-step-backward" aria-hidden="true"></i></a>
                        <a href="javascript:void(0)" data-bind="click: $root.BackPage, visible: VisibleStartPage "><i class="fa fa-caret-left" aria-hidden="true"></i></a>
                        <ul data-bind="foreach: PageList_Display">
                            <li>
                                <a href="javascript:void(0)" data-bind="text: pageNumber, click: $root.GoToPageHD, css: $root.GetClassHD($data)"></a>
                            </li>
                        </ul>
                        <a href="javascript:void(0)" data-bind="click: $root.GoToNextPage, visible: VisibleEndPage "><i class="fa fa-caret-right" aria-hidden="true"></i></a>
                        <a href="javascript:void(0)" data-bind="click: $root.EndPage, visible: VisibleEndPage "><i class="fa fa-step-forward" aria-hidden="true"></i></a>
                        <div class="total-recos">
                            Hiển thị <span data-bind="text: fromitem"></span> - <span data-bind="text: toitem"></span> trên tổng số
                            <span data-bind="text: TotalRecord"></span> hóa đơn.
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<div class="modal " id="modalPopuplgDelete">
    <div class="modal-dialog draggable">
        @Html.Action("_modalDelete", new { area = "", Controller = "GiaoDich" })
    </div>
</div>
<script src="~/Scripts/Components/Input.js"></script>
<script src="~/Scripts/Components/NhanVien_KhachHang.js"></script>
@Html.Partial("~/Views/Gara/HoaDon/_ThuTienHoaDon.cshtml")
@Html.Partial("~/Views/Gara/HoaDon/_EditHoaHongHD.cshtml")
@Html.Partial("~/Views/Gara/HoaDon/_ThongTinHoaDon.cshtml")
@Html.Partial("~/Views/Gara/HoaDon/_ThanhPhanCombo.cshtml")

<div id="vmImportTonDauGDV" class="modal fade">
    <import-dinhluong :title="title"
                      :is-chosing-file="isChosingFile"
                      :is-show-checkbox-pass-err="false"
                      :list-chose="ListChose"
                      :list-error="ListErr"
                      v-on:import-file="ImportFile"
                      v-on:download-file="DownloadFile"
                      v-on:change-type-update="ChangeTypeUpdate">

    </import-dinhluong>
</div>
<script src="~/Scripts/Components/importExcel.js"></script>
<script>
    var vmImportTonDauGDV = new Vue({
        el: "#vmImportTonDauGDV",
        components: {
            'import-dinhluong': cpmImportExcel,
        },
        data: {
            title: 'Nhập file tồn gói dịch vụ',
            isChosingFile: false,
            typeUpdate: 1,
            ListChose: [],
            ListErr: [],
        },
        methods:
        {
            showModal: function () {
                let self = this;
                self.importOK = false;
                self.isChosingFile = false;
                self.ListErr = [];
                $('#vmImportTonDauGDV').modal('show');
            },
            DownloadFile: function (type) {
                let self = this;
                let url = '/api/DanhMuc/DM_HangHoaAPI/' + "Download_TeamplateImport?fileSave=FileImport_SoDuDauKyGoiDichVu.xlsx";
                window.location.href = url;
            },
            ChangeTypeUpdate: function (item) {
                var self = this;
                self.typeUpdate = item.ID;
            },
            ImportFile: function (fileChosed) {
                var self = this;
                var err = self.ListErr.map(function (x) { return x.rowError }).filter(x => x !== -1);
                var formData = new FormData();
                if (!commonStatisJs.CheckNull(fileChosed.file)) {
                    formData.append("file", fileChosed.file);
                    //formData.append("ListErr", err.toString());
                }
                $('#vmImportTonDauGDV').gridLoader();
                $.ajax({
                    type: "POST",
                    url: "/api/DanhMuc/BH_HoaDonAPI/ImportExcel_TonGDV?idDonVi=" + VHeader.IdDonVi + '&idNhanVien=' + VHeader.IdNhanVien + '&nguoitao=' + VHeader.UserLogin,
                    data: formData,
                    dataType: 'json',
                    contentType: false,
                    processData: false,
                }).done(function (x) {
                    if (x.res) {
                        ShowMessage_Success("Import file thành công");
                        self.ListErr = [];
                        $('#vmImportTonDauGDV').modal('hide');
                        self.importOK = true;
                    }
                    else {
                        ShowMessage_Danger("Import file thất bại");
                        self.ListErr = x.dataSoure;
                        self.importOK = false;
                    }
                }).always(function (x) {
                    $('#vmImportTonDauGDV').gridLoader({ show: false });
                });
            },
        }
    });
</script>

<script>
    var $table = '#tb';
    $(document).on('click', '.open-li', function () {
        $(".op-filter-container ul li").css("display", "block");
        $(this).toggle();
        $(this).next(".close-li").toggle();
    });
    $(document).on('click', '.close-li', function () {
        $(".op-filter-container ul li").css("display", "none");
        $(this).toggle();
        $(this).prev(".open-li").toggle();
        $(".op-filter-container ul li").eq(0).css("display", "block");
        $(".op-filter-container ul li").eq(1).css("display", "block");
    });
    var heigth = 0;
    var heightold = 0;
    var setTop = 0;
    function LoadGetHeight() {
        sleep(100).then(() => { setHeight(); });
    };
    function setHeight() {
        heigth = heigth - heightold;
        $('#tb tr').each(function () {
            if ($(this).hasClass('ac')) {
                heightold = $(this).height();
            }
        });
        heigth += heightold;
        $('.line-right').css("margin-top", setTop + "px").height(heigth);
    }
    function SetHeightShowDetail($this) {
        if (!isNew) {
            var t = $this.next(".op-js-tr-hide").css("display");
            if (t !== "none") {
                heightold = $this.next().height();
                heigth = parseInt($this.height()) + heightold;
                $('.line-right').height(heigth).css("margin-top", setTop + "px");
            }
        }
        else {
            isNew = false;
        }
    }
    var isNew = false;
    $($table).on('click', '.prev-tr-hide td', function () {
        if ($(this).hasClass('check-group')) {
        }
        else {
            var parentTR = $(this).parent();
            isNew = true;
            setTop = 35 + parseInt($(parentTR).height() * ($(parentTR).index() / 2));
            $(parentTR).parents(".table-reponsive").toggleClass("table_re");
            var t = $(parentTR).next(".op-js-tr-hide").css("display");
            $(".prev-tr-hide td").not($(parentTR).find("td")).removeClass("bor");
            $("td").not($(parentTR).find("td")).removeClass("bg-gray");
            $(".prev-tr-hide").not($(parentTR)).removeClass("bor-right");
            $(parentTR).toggleClass("bor-right");
            $(parentTR).find("td").toggleClass("bg-gray");
            $(parentTR).find("td").toggleClass("bor");
            if (t == "none") {
                if (parseInt($('#SelecttedPage').val()) >= 20) {
                    $(".table-reponsive").addClass('height470');
                }
                $(".op-js-tr-hide").removeClass("ac");
                $('.line-right').height(0).css("margin-top", "0px");
            }
            else {
                if (parseInt($('#SelecttedPage').val()) >= 20) {
                    $(".table-reponsive").removeClass('height470');
                }
                $(".op-js-tr-hide").removeClass("ac");
                $(parentTR).next(".op-js-tr-hide").addClass("ac");
                heightold = $(parentTR).next().height();
                heigth = parseInt($(parentTR).height()) + heightold;
                $('.line-right').height(heigth).css("margin-top", setTop + "px");
            }
        }
    });
    $(function () {
        $('.datetimepicker4').datetimepicker({
            format: 'DD/MM/YYYY'
        });
    });
    $(document).on('click', '.choose-date .dropdown-menu ul li', function () {
        var date = $(this).find("a").html();
        $(".choose-date-show").val(date);
    });
    $(window.document).on('shown.bs.modal', '.modal', function () {
        window.setTimeout(function () {
            $('[autofocus]', this).focus();
            $('[autofocus]').select();
        }.bind(this), 100);
    });
    jQuery.datetimepicker.setLocale('vi');
    var loaiHoaDon = 19;
    $('#tb').on('click', '.icon-filter', function () {
        $(this).hide();
        $(this).closest('th').find('.icon-filter2').show();
        $(this).closest('th').next().toggle();
        if ($(window).width() <= 1024) {
            $(this).closest('th').find('.right-inner-addon input').attr("placeholder", "Tìm kiếm hàng hóa");
        }
        else { $(this).closest('th').find('.right-inner-addon input').attr('placeholder', 'Tìm kiếm chi tiết hàng hóa'); }
        if ($(this).closest('th').find('.right-inner-addon').css('display') === 'none') {
            $(this).closest('th').attr('colspan', 2).addClass('actioveFilter');
        }
        else {
            $(this).closest('th').attr('colspan', 1).removeClass('actioveFilter');
        }
        $(this).closest('th').find('.right-inner-addon').toggle();
    });
    $('#tb').on('click', ' .icon-filter2', function () {
        $(this).hide();
        $(this).closest('th').find('.icon-filter').show();
        $(this).closest('th').next().toggle();
        if ($(this).closest('th').find('.right-inner-addon').css('display') === 'none') {
            $(this).closest('th').attr('colspan', 2).addClass('actioveFilter');
        }
        else {
            $(this).closest('th').attr('colspan', 1).removeClass('actioveFilter');
        }
        $(this).closest('th').find('.right-inner-addon').toggle();
    });
    var dathangTeamplate = '@commonEnum.MauInTeamPlates.GoiDV';
    var funcName = '@RoleKey.GoiDichVu';
    var t = $(".table-reponsive").width();
</script>
<script src="@Html.WriteRenderFile(Scripts.Url("~/bundles/GoiDichVu"))" type="text/javascript"></script>
<script>
    $("#shownhapxuat").on("click", function () {
        if ($("html").width() > 425) {
            $(".btnImport").toggleClass("forcehide");
            $(".btnExport").toggleClass("forcehide");
        } else {
            $(".btnExport").toggleClass("forcehide");
        }
    });
</script>
